<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Cassandra</title>
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/moon.css" id="theme">

	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/solarized-dark.min.css">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	<!--Add support for earlier versions of Internet Explorer -->
	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
</head>

<body>
	<!-- Wrap the entire slide show in a div using the "reveal" class. -->
	<div class="reveal">
		<!-- Wrap all slides in a single "slides" class -->
		<div class="slides">

      <!-- Présentation -->
			<section>
				<h1>Cassandra</h1>
				<p>Une grosse base de données</p>
			</section>

			<section id="show-a-link">
				<h1>Contexte</h1>
				<p>Initié par Facebook</p>
				<p>Massivement utilisé par Apple</a><p>
			</section>

			<section id="show-a-link">
				<h1>Description</h1>
				<p>Base de données NoSQL</p>
        <ul>
          <li>dénormalisation des données</li>
          <li>pas de transaction (enfin un peu quand même…)</li>
          <li>grosse capacité de scaling</li>
        </ul>
        <p>Développée en Java principalement pour Linux</p>
			</section>

      <!-- Modélisation -->
			<section id="show-a-link">
        <section>
				  <h1>Modélisation</h1>
        </section>
        <section>
				  <h2>Tables/Colonne</h2>
          <p>Comme en SQL sans liens<p>
          <p>Possibilité d'utiliser des types complexes</p>
        </section>
        <section>
				  <h2>Clefs</h2>
          <p>Clef de partitionnement</p>
          <p>Clef de machin truc</p>
          <p>Index</p><!-- définition parcimonie -->
        </section>
			</section>

      <!-- Cas pratique -->
			<section>
	      <section>
	        <h1>Modélisation des données</h1>
	        <p>On souhaite créer un forum, c'est à dire une liste de messages regroupés par fil de discussions, regroupés par catégorie.</p>
	      </section>
	      <section>
					<p>Liste des champs :</p>
					<ul>
						<li>id du message</li>
						<li>autheur</li>
						<li>contenu</li>
						<li>date</li>
						<li>contenu</li>
						<li>catégorie</li>
						<li>sujet</li>
						<li>pièces jointes</li>
					</ul>
	      </section>
	      <section>
					<p>Une solution</p>
					<pre><code>
CREATE TABLE forum.messages (
  cat text,
  subject text,
  id uuid,
  date long,
  author text,
  content text,
  pièce_jointe blob,

  PRIMARY KEY ((cat), subject, id, date)
);
					</code></pre>
	      </section>
			</section>

      <!-- Requètes -->
      <section>
        <h2>Requètes</h2>
				<!-- exemple de requète -->
				<p>Récupérer tous les messages d'un fil :</p>
				<pre><code class="sql">
SELECT * from forum.messages WHERE cat = 'cat1' and subject = 'sub1';
				</code></pre>
				<p>Poster un nouveau message</p>
				<pre><code>
INSERT INFOR forum.messages (cat, subject, id, date, author, content)
VALUES (
	'cat1',
	'sub1',
	cfd66ccc-d857-4e90-b1e5-df98a3d40cd6,
	,
	'barmic',
	'Voici mon message'
);
				</code></pre>
				<p>Avoir la liste des sujets d'une catégorie</p>
				<pre><code>
SELECT * from forum.messages WHERE cat = 'cat1';
				</code></pre>
      </section>

      <!-- Évolution du cas… -->
      <section>
				<section>
	        <h2>Plus compliqué</h2>
					<p>Comment obtenir tous les posts d'un utilisateur donné ?</p>
					<pre class="fragment fade-up visible" data-fragment-index="1"><code>SELECT * FROM forum.messages WHERE author = 'foo';</code></pre>
					<p class="fragment fade-up visible current-visible" data-fragment-index="2">Impossible !</p>
				</section>
					<section>
						<p>Création d'une vue matérialisée</p>
						<pre class="fragment fade-in visible" data-fragment-index="1"><code>
CREATE MATERIALIZED VIEW forum.byAuthor AS
SELECT user FROM forum.messages
WHERE author  IS NOT NULL
  AND cat     IS NOT NULL
  AND subject IS NOT NULL
  AND id      IS NOT NULL
  AND date    IS NOT NULL
PRIMARY KEY (author)
WITH CLUSTERING ORDER BY (score date);
						</code></pre>
						<p>Requête</p>
						<pre class="fragment fade-in visible" data-fragment-index="2"><code>
SELECT * from forum.byAuthor WHERE author = 'foo';
						</code></pre>
					</section>
      </section>

      <!-- Un petit peu de code -->
      <section>
        <h2>Un peu de code…</h2>
        <p>Cas pratique</p>
      </section>

			</div>
	</div>
	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// Required, even if empty.
		Reveal.initialize({
		});
	</script>
</body>
</html>
